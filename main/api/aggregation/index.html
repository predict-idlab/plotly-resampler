
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the Plotly Resampler; a wrapper for plotly Figures to visualize large time-series data.">
      
      
      
        <link rel="canonical" href="https://predict-idlab.github.io/plotly-resampler/main/api/aggregation/">
      
      
        <link rel="prev" href="../../dash_app_integration/">
      
      
        <link rel="next" href="aggregation_interface/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>aggregation - Plotly Resampler Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aggregation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Plotly Resampler Documentation" class="md-header__button md-logo" aria-label="Plotly Resampler Documentation" data-md-component="logo">
      
  <img src="../../static/icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Plotly Resampler Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              aggregation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/predict-idlab/plotly-resampler" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    plotly-resampler
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting_started/" class="md-tabs__link">
        
  
  
    
  
  Get started 🚀

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../dash_app_integration/" class="md-tabs__link">
        
  
  
    
  
  Dash apps 🤝

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API 📖

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../FAQ/" class="md-tabs__link">
        
  
  
    
  
  FAQ ❓

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Plotly Resampler Documentation" class="md-nav__button md-logo" aria-label="Plotly Resampler Documentation" data-md-component="logo">
      
  <img src="../../static/icon.png" alt="logo">

    </a>
    Plotly Resampler Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/predict-idlab/plotly-resampler" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    plotly-resampler
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get started 🚀
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dash_app_integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dash apps 🤝
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API 📖
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API 📖
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    aggregation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            aggregation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="aggregation_interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    aggregation_interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="aggregators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    aggregators
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gap_handler_interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gap_handler_interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="gap_handlers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gap_handlers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="plotly_aggregator_parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    plotly_aggregator_parser
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    figure_resampler
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            figure_resampler
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_resampler/figure_resampler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    figure_resampler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_resampler/figure_resampler_interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    figure_resampler_interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_resampler/figurewidget_resampler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    figurewidget_resampler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_resampler/jupyter_dash_persistent_inline_output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    jupyter_dash_persistent_inline_output
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../figure_resampler/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../registering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    registering
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../FAQ/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ ❓
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      aggregation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.AbstractAggregator" class="md-nav__link">
    <span class="md-ellipsis">
      AbstractAggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractAggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation.AbstractAggregator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.AbstractGapHandler" class="md-nav__link">
    <span class="md-ellipsis">
      AbstractGapHandler
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AbstractGapHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation.AbstractGapHandler.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation.AbstractGapHandler.insert_fill_value_between_gaps" class="md-nav__link">
    <span class="md-ellipsis">
      insert_fill_value_between_gaps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.EveryNthPoint" class="md-nav__link">
    <span class="md-ellipsis">
      EveryNthPoint
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.FuncAggregator" class="md-nav__link">
    <span class="md-ellipsis">
      FuncAggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FuncAggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation.FuncAggregator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.LTTB" class="md-nav__link">
    <span class="md-ellipsis">
      LTTB
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.MedDiffGapHandler" class="md-nav__link">
    <span class="md-ellipsis">
      MedDiffGapHandler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.MinMaxAggregator" class="md-nav__link">
    <span class="md-ellipsis">
      MinMaxAggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MinMaxAggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation.MinMaxAggregator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.MinMaxLTTB" class="md-nav__link">
    <span class="md-ellipsis">
      MinMaxLTTB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MinMaxLTTB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation.MinMaxLTTB.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.MinMaxOverlapAggregator" class="md-nav__link">
    <span class="md-ellipsis">
      MinMaxOverlapAggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.NoGapHandler" class="md-nav__link">
    <span class="md-ellipsis">
      NoGapHandler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregation.PlotlyAggregatorParser" class="md-nav__link">
    <span class="md-ellipsis">
      PlotlyAggregatorParser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlotlyAggregatorParser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregation.PlotlyAggregatorParser.aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation.PlotlyAggregatorParser.get_start_end_indices" class="md-nav__link">
    <span class="md-ellipsis">
      get_start_end_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation.PlotlyAggregatorParser.parse_hf_data" class="md-nav__link">
    <span class="md-ellipsis">
      parse_hf_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregation.PlotlyAggregatorParser.to_same_tz" class="md-nav__link">
    <span class="md-ellipsis">
      to_same_tz
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>aggregation</h1>

<div class="doc doc-object doc-module">



<a id="aggregation"></a>
    <div class="doc doc-contents first">

      <p>Compatible implementation for various downsample methods and open interface to 
other downsample methods.</p>



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aggregation.AbstractAggregator" class="doc doc-heading">
            <code>AbstractAggregator</code>


<a href="#aggregation.AbstractAggregator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/aggregation_interface.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbstractAggregator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_dtype_regex_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y_dtype_regex_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor of AbstractSeriesAggregator.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_dtype_regex_list: List[str], optional</span>
<span class="sd">            List containing the regex matching the supported datatypes for the x array,</span>
<span class="sd">            by default None.</span>
<span class="sd">        y_dtype_regex_list: List[str], optional</span>
<span class="sd">            List containing the regex matching the supported datatypes for the y array,</span>
<span class="sd">            by default None.</span>
<span class="sd">        downsample_kwargs: dict</span>
<span class="sd">            Additional kwargs passed to the downsample method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_dtype_regex_list</span> <span class="o">=</span> <span class="n">x_dtype_regex_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_dtype_regex_list</span> <span class="o">=</span> <span class="n">y_dtype_regex_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downsample_kwargs</span> <span class="o">=</span> <span class="n">downsample_kwargs</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_n_out</span><span class="p">(</span><span class="n">n_out</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the n_out is valid.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_out</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">n_out</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_process_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the args into the x and y arrays.</span>

<span class="sd">        If only y is passed, x is set to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;Must pass either 1 or 2 arrays&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">args</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_arr</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">regex_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the array is valid.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Expected np.ndarray, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">AbstractAggregator</span><span class="o">.</span><span class="n">_supports_dtype</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">regex_list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_x_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the x and y arrays are valid.&quot;&quot;&quot;</span>
        <span class="c1"># Check x (if not None)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_arr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_dtype_regex_list</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;x and y must have the same shape&quot;</span>
        <span class="c1"># Check y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_arr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_dtype_regex_list</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_supports_dtype</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dtype_regex_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># base case</span>
        <span class="k">if</span> <span class="n">dtype_regex_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">dtype_regex_str</span> <span class="ow">in</span> <span class="n">dtype_regex_list</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">dtype_regex_str</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># a match is found</span>
                <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> doesn&#39;t match with any regex in </span><span class="si">{</span><span class="n">dtype_regex_list</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregation.AbstractAggregator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">x_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span></code>

<a href="#aggregation.AbstractAggregator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Constructor of AbstractSeriesAggregator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x_dtype_regex_list</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List containing the regex matching the supported datatypes for the x array,
by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y_dtype_regex_list</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[str]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List containing the regex matching the supported datatypes for the y array,
by default None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>downsample_kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional kwargs passed to the downsample method.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/aggregation_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">x_dtype_regex_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">y_dtype_regex_list</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor of AbstractSeriesAggregator.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x_dtype_regex_list: List[str], optional</span>
<span class="sd">        List containing the regex matching the supported datatypes for the x array,</span>
<span class="sd">        by default None.</span>
<span class="sd">    y_dtype_regex_list: List[str], optional</span>
<span class="sd">        List containing the regex matching the supported datatypes for the y array,</span>
<span class="sd">        by default None.</span>
<span class="sd">    downsample_kwargs: dict</span>
<span class="sd">        Additional kwargs passed to the downsample method.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_dtype_regex_list</span> <span class="o">=</span> <span class="n">x_dtype_regex_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_dtype_regex_list</span> <span class="o">=</span> <span class="n">y_dtype_regex_list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">downsample_kwargs</span> <span class="o">=</span> <span class="n">downsample_kwargs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.AbstractGapHandler" class="doc doc-heading">
            <code>AbstractGapHandler</code>


<a href="#aggregation.AbstractGapHandler" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/gap_handler_interface.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AbstractGapHandler</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor of AbstractGapHandler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fill_value: float, optional</span>
<span class="sd">            The value to fill the gaps with, by default None.</span>
<span class="sd">            Note that setting this value to 0 for filled area plots is particularly</span>
<span class="sd">            useful.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_gap_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a boolean mask indicating the indices where there are gaps.</span>

<span class="sd">        If you require custom gap handling, you can implement this method to return a</span>
<span class="sd">        boolean mask indicating the indices where there are gaps.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_agg: np.ndarray</span>
<span class="sd">            The x array. This is used to determine the gaps.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[np.ndarray]</span>
<span class="sd">            A boolean mask indicating the indices where there are gaps. If there are no</span>
<span class="sd">            gaps, None is returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">insert_fill_value_between_gaps</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">y_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">idxs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert the fill_value in the y_agg array where there are gaps.</span>

<span class="sd">        Gaps are determined by the x_agg array. The `_get_gap_mask` method is used to</span>
<span class="sd">        determine a boolean mask indicating the indices where there are gaps.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_agg: np.ndarray</span>
<span class="sd">            The x array. This is used to determine the gaps.</span>
<span class="sd">        y_agg: np.ndarray</span>
<span class="sd">            The y array. A copy of this array will be expanded with fill_values where</span>
<span class="sd">            there are gaps.</span>
<span class="sd">        idxs: np.ndarray</span>
<span class="sd">            The index array. This is relevant aggregators that perform data point</span>
<span class="sd">            selection (e.g., max, min, etc.) - this array will be expanded with the</span>
<span class="sd">            same indices where there are gaps.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">            The expanded y_agg array and the expanded idxs array respectively.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gap_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gap_mask</span><span class="p">(</span><span class="n">x_agg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gap_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># no gaps are found, nothing to do</span>
            <span class="k">return</span> <span class="n">y_agg</span><span class="p">,</span> <span class="n">idxs</span>

        <span class="c1"># An array filled with 1s and 2s, where 2 indicates a large gap mask</span>
        <span class="c1"># (i.e., that index will be repeated twice)</span>
        <span class="n">repeats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">gap_mask</span>

        <span class="c1"># use the repeats to expand the idxs, and agg_y array</span>
        <span class="n">idx_exp_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">idxs</span><span class="p">,</span> <span class="n">repeats</span><span class="p">)</span>
        <span class="n">y_agg_exp_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y_agg</span><span class="p">,</span> <span class="n">repeats</span><span class="p">)</span>

        <span class="c1"># only float arrays can contain NaN values</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">y_agg_exp_nan</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span>
            <span class="n">y_agg_exp_nan</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span>
        <span class="p">):</span>
            <span class="n">y_agg_exp_nan</span> <span class="o">=</span> <span class="n">y_agg_exp_nan</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>

        <span class="c1"># Set the NaN values</span>
        <span class="c1"># We add the gap index offset (via the np.arange) to the indices to account for</span>
        <span class="c1"># the repeats (i.e., expanded y_agg array).</span>
        <span class="n">y_agg_exp_nan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gap_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">gap_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">())]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">y_agg_exp_nan</span><span class="p">,</span> <span class="n">idx_exp_nan</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregation.AbstractGapHandler.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">fill_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#aggregation.AbstractGapHandler.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Constructor of AbstractGapHandler.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fill_value</code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[float]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to fill the gaps with, by default None.
Note that setting this value to 0 for filled area plots is particularly
useful.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/gap_handler_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructor of AbstractGapHandler.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fill_value: float, optional</span>
<span class="sd">        The value to fill the gaps with, by default None.</span>
<span class="sd">        Note that setting this value to 0 for filled area plots is particularly</span>
<span class="sd">        useful.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span> <span class="o">=</span> <span class="n">fill_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aggregation.AbstractGapHandler.insert_fill_value_between_gaps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert_fill_value_between_gaps</span><span class="p">(</span><span class="n">x_agg</span><span class="p">,</span> <span class="n">y_agg</span><span class="p">,</span> <span class="n">idxs</span><span class="p">)</span></code>

<a href="#aggregation.AbstractGapHandler.insert_fill_value_between_gaps" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Insert the fill_value in the y_agg array where there are gaps.</p>
<p>Gaps are determined by the x_agg array. The <code>_get_gap_mask</code> method is used to
determine a boolean mask indicating the indices where there are gaps.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>x_agg</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The x array. This is used to determine the gaps.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>y_agg</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The y array. A copy of this array will be expanded with fill_values where
there are gaps.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>idxs</code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The index array. This is relevant aggregators that perform data point
selection (e.g., max, min, etc.) - this array will be expanded with the
same indices where there are gaps.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The expanded y_agg array and the expanded idxs array respectively.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/gap_handler_interface.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">insert_fill_value_between_gaps</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">x_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">y_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">idxs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Insert the fill_value in the y_agg array where there are gaps.</span>

<span class="sd">    Gaps are determined by the x_agg array. The `_get_gap_mask` method is used to</span>
<span class="sd">    determine a boolean mask indicating the indices where there are gaps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x_agg: np.ndarray</span>
<span class="sd">        The x array. This is used to determine the gaps.</span>
<span class="sd">    y_agg: np.ndarray</span>
<span class="sd">        The y array. A copy of this array will be expanded with fill_values where</span>
<span class="sd">        there are gaps.</span>
<span class="sd">    idxs: np.ndarray</span>
<span class="sd">        The index array. This is relevant aggregators that perform data point</span>
<span class="sd">        selection (e.g., max, min, etc.) - this array will be expanded with the</span>
<span class="sd">        same indices where there are gaps.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">        The expanded y_agg array and the expanded idxs array respectively.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_gap_mask</span><span class="p">(</span><span class="n">x_agg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gap_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># no gaps are found, nothing to do</span>
        <span class="k">return</span> <span class="n">y_agg</span><span class="p">,</span> <span class="n">idxs</span>

    <span class="c1"># An array filled with 1s and 2s, where 2 indicates a large gap mask</span>
    <span class="c1"># (i.e., that index will be repeated twice)</span>
    <span class="n">repeats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">gap_mask</span>

    <span class="c1"># use the repeats to expand the idxs, and agg_y array</span>
    <span class="n">idx_exp_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">idxs</span><span class="p">,</span> <span class="n">repeats</span><span class="p">)</span>
    <span class="n">y_agg_exp_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y_agg</span><span class="p">,</span> <span class="n">repeats</span><span class="p">)</span>

    <span class="c1"># only float arrays can contain NaN values</span>
    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">y_agg_exp_nan</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">issubclass</span><span class="p">(</span>
        <span class="n">y_agg_exp_nan</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span>
    <span class="p">):</span>
        <span class="n">y_agg_exp_nan</span> <span class="o">=</span> <span class="n">y_agg_exp_nan</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>

    <span class="c1"># Set the NaN values</span>
    <span class="c1"># We add the gap index offset (via the np.arange) to the indices to account for</span>
    <span class="c1"># the repeats (i.e., expanded y_agg array).</span>
    <span class="n">y_agg_exp_nan</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gap_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">gap_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">())]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_value</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">y_agg_exp_nan</span><span class="p">,</span> <span class="n">idx_exp_nan</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.EveryNthPoint" class="doc doc-heading">
            <code>EveryNthPoint</code>


<a href="#aggregation.EveryNthPoint" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aggregation.aggregation.aggregation_interface.DataPointSelector">DataPointSelector</span></code></p>


      <p>Naive (but fast) aggregator method which returns every N&rsquo;th point.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This downsampler supports all dtypes.</p>
</div>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EveryNthPoint</span><span class="p">(</span><span class="n">DataPointSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Naive (but fast) aggregator method which returns every N&#39;th point.</span>

<span class="sd">    !!! note</span>
<span class="sd">        This downsampler supports all dtypes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_arg_downsample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">n_out</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">EveryNthDownsampler</span><span class="p">()</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">n_out</span><span class="o">=</span><span class="n">n_out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.FuncAggregator" class="doc doc-heading">
            <code>FuncAggregator</code>


<a href="#aggregation.FuncAggregator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aggregation.aggregation.aggregation_interface.DataAggregator">DataAggregator</span></code></p>


      <p>Aggregator instance which uses the passed aggregation func.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The user has total control which <code>aggregation_func</code> is passed to this method,
hence the user should be careful to not make copies of the data, nor write to
the data. Furthermore, the user should beware of performance issues when
using more complex aggregation functions.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Attention</p>
<p>The user has total control which <code>aggregation_func</code> is passed to this method,
hence it is the users&rsquo; responsibility to handle categorical and bool-based
data types.</p>
</div>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FuncAggregator</span><span class="p">(</span><span class="n">DataAggregator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregator instance which uses the passed aggregation func.</span>

<span class="sd">    !!! warning</span>

<span class="sd">        The user has total control which `aggregation_func` is passed to this method,</span>
<span class="sd">        hence the user should be careful to not make copies of the data, nor write to</span>
<span class="sd">        the data. Furthermore, the user should beware of performance issues when</span>
<span class="sd">        using more complex aggregation functions.</span>

<span class="sd">    !!! warning &quot;Attention&quot;</span>

<span class="sd">        The user has total control which `aggregation_func` is passed to this method,</span>
<span class="sd">        hence it is the users&#39; responsibility to handle categorical and bool-based</span>
<span class="sd">        data types.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">aggregation_func</span><span class="p">,</span>
        <span class="n">x_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">y_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aggregation_func: Callable</span>
<span class="sd">            The aggregation function which will be applied on each pin.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_func</span> <span class="o">=</span> <span class="n">aggregation_func</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x_dtype_regex_list</span><span class="p">,</span> <span class="n">y_dtype_regex_list</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_aggregate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">n_out</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate the data using the object&#39;s aggregation function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x: np.ndarray | None</span>
<span class="sd">            The x-values of the data. Can be None if no x-values are available.</span>
<span class="sd">        y: np.ndarray</span>
<span class="sd">            The y-values of the data.</span>
<span class="sd">        n_out: int</span>
<span class="sd">            The number of output data points.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Additional keyword arguments, which are passed to the aggregation function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray]</span>
<span class="sd">            The aggregated x &amp; y values.</span>
<span class="sd">            If `x` is None, then the indices of the first element of each bin is</span>
<span class="sd">            returned as x-values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create an index-estimation for real-time data</span>
        <span class="c1"># Add one to the index so it&#39;s pointed at the end of the window</span>
        <span class="c1"># Note: this can be adjusted to .5 to center the data</span>
        <span class="c1"># Multiply it with the group size to get the real index-position</span>
        <span class="c1"># TODO: add option to select start / middle / end as index</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># equidistant index</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">n_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xdt</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">xdt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">xdt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
            <span class="c1"># Thanks to `linspace`, the data is evenly distributed over the index-range</span>
            <span class="c1"># The searchsorted function returns the index positions</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">y_agg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_func</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">t1</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">downsample_kwargs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idxs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_agg</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">idxs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># x is None -&gt; return the indices of the first element of each bin</span>
            <span class="n">x_agg</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">x_agg</span><span class="p">,</span> <span class="n">y_agg</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregation.FuncAggregator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">aggregation_func</span><span class="p">,</span> <span class="n">x_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span></code>

<a href="#aggregation.FuncAggregator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>aggregation_func</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The aggregation function which will be applied on each pin.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">aggregation_func</span><span class="p">,</span>
    <span class="n">x_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y_dtype_regex_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    aggregation_func: Callable</span>
<span class="sd">        The aggregation function which will be applied on each pin.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aggregation_func</span> <span class="o">=</span> <span class="n">aggregation_func</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">x_dtype_regex_list</span><span class="p">,</span> <span class="n">y_dtype_regex_list</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.LTTB" class="doc doc-heading">
            <code>LTTB</code>


<a href="#aggregation.LTTB" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aggregation.aggregation.aggregation_interface.DataPointSelector">DataPointSelector</span></code></p>


      <p>Largest Triangle Three Buckets (LTTB) aggregation method.</p>
<p>This is arguably the most widely used aggregation method. It is based on the
effective area of a triangle (inspired from the line simplification domain).
The algorithm has $O(n)$ complexity, however, for large datasets, it can be much
slower than other algorithms (e.g. MinMax) due to the higher cost of calculating
the areas of triangles.</p>
<p>Thesis: <a href="https://skemman.is/bitstream/1946/15343/3/SS_MSthesis.pdf">https://skemman.is/bitstream/1946/15343/3/SS_MSthesis.pdf</a> <br/>
Details on visual representativeness &amp; stability: <a href="https://arxiv.org/abs/2304.00900">https://arxiv.org/abs/2304.00900</a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><code>LTTB</code> doesn&rsquo;t scale super-well when moving to really large datasets, so when
dealing with more than 1 million samples, you might consider using
<a class="autorefs autorefs-internal" href="aggregators/#aggregation.aggregators.MinMaxLTTB"><code>MinMaxLTTB</code></a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>This class is mainly designed to operate on numerical data as LTTB calculates
  distances on the values. <br/>
  When dealing with categories, the data is encoded into its numeric codes,
  these codes are the indices of the category array.</li>
<li>To aggregate category data with LTTB, your <code>pd.Series</code> must be of dtype
  &lsquo;category&rsquo;. <br/></li>
</ul>
<p><strong>tip</strong>:</p>
<p>if there is an order in your categories, order them that way, LTTB uses
  the ordered category codes values (see bullet above) to calculate distances and
  make aggregation decisions. <br/>
  <strong>code</strong>:
    <div class="highlight"><pre><span></span><code>    <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">])</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">cat_type</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">],</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">s_cat</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">cat_type</span><span class="p">)</span>
</code></pre></div>
* <code>LTTB</code> has no downsample kwargs, as it cannot be paralellized. Instead, you can
  use the <a class="autorefs autorefs-internal" href="aggregators/#aggregation.aggregators.MinMaxLTTB"><code>MinMaxLTTB</code></a> downsampler, which performs
  minmax preselection (in parallel if configured so), followed by LTTB.</p>
</div>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LTTB</span><span class="p">(</span><span class="n">DataPointSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Largest Triangle Three Buckets (LTTB) aggregation method.</span>

<span class="sd">    This is arguably the most widely used aggregation method. It is based on the</span>
<span class="sd">    effective area of a triangle (inspired from the line simplification domain).</span>
<span class="sd">    The algorithm has $O(n)$ complexity, however, for large datasets, it can be much</span>
<span class="sd">    slower than other algorithms (e.g. MinMax) due to the higher cost of calculating</span>
<span class="sd">    the areas of triangles.</span>

<span class="sd">    Thesis: [https://skemman.is/bitstream/1946/15343/3/SS_MSthesis.pdf](https://skemman.is/bitstream/1946/15343/3/SS_MSthesis.pdf) &lt;br/&gt;</span>
<span class="sd">    Details on visual representativeness &amp; stability: [https://arxiv.org/abs/2304.00900](https://arxiv.org/abs/2304.00900)</span>

<span class="sd">    !!! tip</span>

<span class="sd">        `LTTB` doesn&#39;t scale super-well when moving to really large datasets, so when</span>
<span class="sd">        dealing with more than 1 million samples, you might consider using</span>
<span class="sd">        [`MinMaxLTTB`][aggregation.aggregators.MinMaxLTTB].</span>


<span class="sd">    !!! note</span>

<span class="sd">        * This class is mainly designed to operate on numerical data as LTTB calculates</span>
<span class="sd">          distances on the values. &lt;br/&gt;</span>
<span class="sd">          When dealing with categories, the data is encoded into its numeric codes,</span>
<span class="sd">          these codes are the indices of the category array.</span>
<span class="sd">        * To aggregate category data with LTTB, your ``pd.Series`` must be of dtype</span>
<span class="sd">          &#39;category&#39;. &lt;br/&gt;</span>

<span class="sd">          **tip**:</span>

<span class="sd">          if there is an order in your categories, order them that way, LTTB uses</span>
<span class="sd">          the ordered category codes values (see bullet above) to calculate distances and</span>
<span class="sd">          make aggregation decisions. &lt;br/&gt;</span>
<span class="sd">          **code**:</span>
<span class="sd">            ```python</span>
<span class="sd">                &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">                &gt;&gt;&gt; s = pd.Series([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;a&quot;])</span>
<span class="sd">                &gt;&gt;&gt; cat_type = pd.CategoricalDtype(categories=[&quot;b&quot;, &quot;c&quot;, &quot;a&quot;], ordered=True)</span>
<span class="sd">                &gt;&gt;&gt; s_cat = s.astype(cat_type)</span>
<span class="sd">            ```</span>
<span class="sd">        * `LTTB` has no downsample kwargs, as it cannot be paralellized. Instead, you can</span>
<span class="sd">          use the [`MinMaxLTTB`][aggregation.aggregators.MinMaxLTTB] downsampler, which performs</span>
<span class="sd">          minmax preselection (in parallel if configured so), followed by LTTB.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">y_dtype_regex_list</span><span class="o">=</span><span class="p">[</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">\d*&quot;</span> <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;uint&quot;</span><span class="p">)]</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downsampler</span> <span class="o">=</span> <span class="n">LTTBDownsampler</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_arg_downsample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">n_out</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsampler</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="o">*</span><span class="n">_to_tsdownsample_args</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">n_out</span><span class="o">=</span><span class="n">n_out</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.MedDiffGapHandler" class="doc doc-heading">
            <code>MedDiffGapHandler</code>


<a href="#aggregation.MedDiffGapHandler" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="plotly_resampler.aggregation.gap_handler_interface.AbstractGapHandler">AbstractGapHandler</span></code></p>


      <p>Gap handling based on the median diff of the x_agg array.</p>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/gap_handlers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MedDiffGapHandler</span><span class="p">(</span><span class="n">AbstractGapHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gap handling based on the median diff of the x_agg array.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calc_med_diff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the median diff of the x_agg array.</span>

<span class="sd">        As median is more robust to outliers than the mean, the median is used to define</span>
<span class="sd">        the gap threshold.</span>

<span class="sd">        This method performs a divide and conquer heuristic to calculate the median;</span>
<span class="sd">        1. divide the array into `n_blocks` blocks (with `n_blocks` = 128)</span>
<span class="sd">        2. calculate the mean of each block</span>
<span class="sd">        3. calculate the median of the means</span>
<span class="sd">        =&gt; This proves to be a good approximation of the median of the full array, while</span>
<span class="sd">              being much faster than calculating the median of the full array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># remark: thanks to the prepend -&gt; x_diff.shape === len(s)</span>
        <span class="n">x_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x_agg</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="n">x_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># To do so - use an approach where we reshape the data</span>
        <span class="c1"># into `n_blocks` blocks and calculate the mean and then the median on that</span>
        <span class="c1"># Why use `median` instead of a global mean?</span>
        <span class="c1">#   =&gt; when you have large gaps, they will be represented by a large diff</span>
        <span class="c1">#      which will skew the mean way more than the median!</span>
        <span class="n">n_blocks</span> <span class="o">=</span> <span class="mi">128</span>
        <span class="k">if</span> <span class="n">x_agg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">n_blocks</span><span class="p">:</span>
            <span class="n">blck_size</span> <span class="o">=</span> <span class="n">x_diff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">n_blocks</span>

            <span class="c1"># convert the index series index diff into a reshaped view (i.e., sid_v)</span>
            <span class="n">sid_v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">x_diff</span><span class="p">[:</span> <span class="n">blck_size</span> <span class="o">*</span> <span class="n">n_blocks</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># calculate the mean fore each block and then the median of those means</span>
            <span class="n">med_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sid_v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">med_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x_diff</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">med_diff</span><span class="p">,</span> <span class="n">x_diff</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_gap_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a boolean mask indicating the indices where there are gaps.</span>

<span class="sd">        If you require custom gap handling, you can implement this method to return a</span>
<span class="sd">        boolean mask indicating the indices where there are gaps.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_agg: np.ndarray</span>
<span class="sd">            The x array. This is used to determine the gaps.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[np.ndarray]</span>
<span class="sd">            A boolean mask indicating the indices where there are gaps. If there are no</span>
<span class="sd">            gaps, None is returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">med_diff</span><span class="p">,</span> <span class="n">x_diff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_med_diff</span><span class="p">(</span><span class="n">x_agg</span><span class="p">)</span>

        <span class="c1"># TODO: this 4 was revealed to me in a dream, but it seems to work well</span>
        <span class="c1"># After some consideration, we altered this to a 4.1</span>
        <span class="n">gap_mask</span> <span class="o">=</span> <span class="n">x_diff</span> <span class="o">&gt;</span> <span class="mf">4.1</span> <span class="o">*</span> <span class="n">med_diff</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">gap_mask</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">gap_mask</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.MinMaxAggregator" class="doc doc-heading">
            <code>MinMaxAggregator</code>


<a href="#aggregation.MinMaxAggregator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aggregation.aggregation.aggregation_interface.DataPointSelector">DataPointSelector</span></code></p>


      <p>Aggregation method which performs binned min-max aggregation over fully
overlapping windows.</p>
<p>This is arguably the most computational efficient downsampling method, as it only
performs (non-expensive) comparisons on the data in a single pass.</p>
<p>Details on visual representativeness &amp; stability: <a href="https://arxiv.org/abs/2304.00900">https://arxiv.org/abs/2304.00900</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is rather efficient when scaling to large data sizes and can be used
as a data-reduction step before feeding it to the <a class="autorefs autorefs-internal" href="aggregators/#aggregation.aggregators.LTTB"><code>LTTB</code></a>
algorithm, as <a class="autorefs autorefs-internal" href="aggregators/#aggregation.aggregators.MinMaxLTTB"><code>MinMaxLTTB</code></a> does with the
<a class="autorefs autorefs-internal" href="aggregators/#aggregation.aggregators.MinMaxOverlapAggregator"><code>MinMaxOverlapAggregator</code></a>.</p>
</div>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MinMaxAggregator</span><span class="p">(</span><span class="n">DataPointSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregation method which performs binned min-max aggregation over fully</span>
<span class="sd">    overlapping windows.</span>

<span class="sd">    This is arguably the most computational efficient downsampling method, as it only</span>
<span class="sd">    performs (non-expensive) comparisons on the data in a single pass.</span>

<span class="sd">    Details on visual representativeness &amp; stability: [https://arxiv.org/abs/2304.00900](https://arxiv.org/abs/2304.00900)</span>

<span class="sd">    !!! note</span>

<span class="sd">        This method is rather efficient when scaling to large data sizes and can be used</span>
<span class="sd">        as a data-reduction step before feeding it to the [`LTTB`][aggregation.aggregators.LTTB]</span>
<span class="sd">        algorithm, as [`MinMaxLTTB`][aggregation.aggregators.MinMaxLTTB] does with the</span>
<span class="sd">        [`MinMaxOverlapAggregator`][aggregation.aggregators.MinMaxOverlapAggregator].</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nan_policy</span><span class="o">=</span><span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **downsample_kwargs</span>
<span class="sd">            Keyword arguments passed to the :class:`MinMaxDownsampler`.</span>
<span class="sd">            - The `parallel` argument is set to False by default.</span>
<span class="sd">        nan_policy: str, optional</span>
<span class="sd">            The policy to handle NaNs. Can be &#39;omit&#39; or &#39;keep&#39;. By default, &#39;omit&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this downsampler supports all dtypes</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nan_policy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="s2">&quot;keep&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nan_policy must be either &#39;omit&#39; or &#39;keep&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nan_policy</span> <span class="o">==</span> <span class="s2">&quot;omit&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">downsampler</span> <span class="o">=</span> <span class="n">MinMaxDownsampler</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">downsampler</span> <span class="o">=</span> <span class="n">NaNMinMaxDownsampler</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_arg_downsample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">n_out</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">downsampler</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span>
            <span class="o">*</span><span class="n">_to_tsdownsample_args</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">n_out</span><span class="o">=</span><span class="n">n_out</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">downsample_kwargs</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregation.MinMaxAggregator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span></code>

<a href="#aggregation.MinMaxAggregator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>**downsample_kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the :class:<code>MinMaxDownsampler</code>.
- The <code>parallel</code> argument is set to False by default.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nan_policy</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The policy to handle NaNs. Can be &lsquo;omit&rsquo; or &lsquo;keep&rsquo;. By default, &lsquo;omit&rsquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;omit&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nan_policy</span><span class="o">=</span><span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    **downsample_kwargs</span>
<span class="sd">        Keyword arguments passed to the :class:`MinMaxDownsampler`.</span>
<span class="sd">        - The `parallel` argument is set to False by default.</span>
<span class="sd">    nan_policy: str, optional</span>
<span class="sd">        The policy to handle NaNs. Can be &#39;omit&#39; or &#39;keep&#39;. By default, &#39;omit&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># this downsampler supports all dtypes</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nan_policy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="s2">&quot;keep&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nan_policy must be either &#39;omit&#39; or &#39;keep&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nan_policy</span> <span class="o">==</span> <span class="s2">&quot;omit&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downsampler</span> <span class="o">=</span> <span class="n">MinMaxDownsampler</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downsampler</span> <span class="o">=</span> <span class="n">NaNMinMaxDownsampler</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.MinMaxLTTB" class="doc doc-heading">
            <code>MinMaxLTTB</code>


<a href="#aggregation.MinMaxLTTB" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aggregation.aggregation.aggregation_interface.DataPointSelector">DataPointSelector</span></code></p>


      <p>Efficient version off LTTB by first reducing really large datasets with
the <a class="autorefs autorefs-internal" href="aggregators/#aggregation.aggregators.MinMaxAggregator"><code>MinMaxAggregator</code></a> and then further aggregating the
reduced result with <a class="autorefs autorefs-internal" href="aggregators/#aggregation.aggregators.LTTB"><code>LTTB</code></a>.</p>
<p>Starting from 10M data points, this method performs the MinMax-prefetching of data
points to enhance computational efficiency.</p>
<p>Inventors: Jonas &amp; Jeroen Van Der Donckt - 2022</p>
<p>Paper: <a href="https://arxiv.org/pdf/2305.00332.pdf">https://arxiv.org/pdf/2305.00332.pdf</a></p>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MinMaxLTTB</span><span class="p">(</span><span class="n">DataPointSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Efficient version off LTTB by first reducing really large datasets with</span>
<span class="sd">    the [`MinMaxAggregator`][aggregation.aggregators.MinMaxAggregator] and then further aggregating the</span>
<span class="sd">    reduced result with [`LTTB`][aggregation.aggregators.LTTB].</span>

<span class="sd">    Starting from 10M data points, this method performs the MinMax-prefetching of data</span>
<span class="sd">    points to enhance computational efficiency.</span>

<span class="sd">    Inventors: Jonas &amp; Jeroen Van Der Donckt - 2022</span>

<span class="sd">    Paper: [https://arxiv.org/pdf/2305.00332.pdf](https://arxiv.org/pdf/2305.00332.pdf)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">minmax_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nan_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        minmax_ratio: int, optional</span>
<span class="sd">            The ratio between the number of data points in the MinMax-prefetching and</span>
<span class="sd">            the number of data points that will be outputted by LTTB. By default, 4.</span>
<span class="sd">        nan_policy: str, optional</span>
<span class="sd">            The policy to handle NaNs. Can be &#39;omit&#39; or &#39;keep&#39;. By default, &#39;omit&#39;.</span>
<span class="sd">        **downsample_kwargs</span>
<span class="sd">            Keyword arguments passed to the `MinMaxLTTBDownsampler`.</span>
<span class="sd">            - The `parallel` argument is set to False by default.</span>
<span class="sd">            - The `minmax_ratio` argument is set to 4 by default, which was empirically</span>
<span class="sd">              proven to be a good default.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nan_policy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="s2">&quot;keep&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nan_policy must be either &#39;omit&#39; or &#39;keep&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nan_policy</span> <span class="o">==</span> <span class="s2">&quot;omit&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmaxlttb</span> <span class="o">=</span> <span class="n">MinMaxLTTBDownsampler</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minmaxlttb</span> <span class="o">=</span> <span class="n">NaNMinMaxLTTBDownsampler</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">minmax_ratio</span> <span class="o">=</span> <span class="n">minmax_ratio</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">y_dtype_regex_list</span><span class="o">=</span><span class="p">[</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">\d*&quot;</span> <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;uint&quot;</span><span class="p">)]</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">],</span>
            <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_arg_downsample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">n_out</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minmaxlttb</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span>
            <span class="o">*</span><span class="n">_to_tsdownsample_args</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
            <span class="n">n_out</span><span class="o">=</span><span class="n">n_out</span><span class="p">,</span>
            <span class="n">minmax_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minmax_ratio</span><span class="p">,</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">downsample_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregation.MinMaxLTTB.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">minmax_ratio</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">)</span></code>

<a href="#aggregation.MinMaxLTTB.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>minmax_ratio</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ratio between the number of data points in the MinMax-prefetching and
the number of data points that will be outputted by LTTB. By default, 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>nan_policy</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The policy to handle NaNs. Can be &lsquo;omit&rsquo; or &lsquo;keep&rsquo;. By default, &lsquo;omit&rsquo;.</p>
              </div>
            </td>
            <td>
                  <code>&#39;omit&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>**downsample_kwargs</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments passed to the <code>MinMaxLTTBDownsampler</code>.
- The <code>parallel</code> argument is set to False by default.
- The <code>minmax_ratio</code> argument is set to 4 by default, which was empirically
  proven to be a good default.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">minmax_ratio</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">nan_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">downsample_kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    minmax_ratio: int, optional</span>
<span class="sd">        The ratio between the number of data points in the MinMax-prefetching and</span>
<span class="sd">        the number of data points that will be outputted by LTTB. By default, 4.</span>
<span class="sd">    nan_policy: str, optional</span>
<span class="sd">        The policy to handle NaNs. Can be &#39;omit&#39; or &#39;keep&#39;. By default, &#39;omit&#39;.</span>
<span class="sd">    **downsample_kwargs</span>
<span class="sd">        Keyword arguments passed to the `MinMaxLTTBDownsampler`.</span>
<span class="sd">        - The `parallel` argument is set to False by default.</span>
<span class="sd">        - The `minmax_ratio` argument is set to 4 by default, which was empirically</span>
<span class="sd">          proven to be a good default.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nan_policy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;omit&quot;</span><span class="p">,</span> <span class="s2">&quot;keep&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nan_policy must be either &#39;omit&#39; or &#39;keep&#39;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nan_policy</span> <span class="o">==</span> <span class="s2">&quot;omit&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minmaxlttb</span> <span class="o">=</span> <span class="n">MinMaxLTTBDownsampler</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minmaxlttb</span> <span class="o">=</span> <span class="n">NaNMinMaxLTTBDownsampler</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">minmax_ratio</span> <span class="o">=</span> <span class="n">minmax_ratio</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">y_dtype_regex_list</span><span class="o">=</span><span class="p">[</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">\d*&quot;</span> <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="s2">&quot;uint&quot;</span><span class="p">)]</span>
        <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;bool&quot;</span><span class="p">],</span>
        <span class="o">**</span><span class="n">downsample_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.MinMaxOverlapAggregator" class="doc doc-heading">
            <code>MinMaxOverlapAggregator</code>


<a href="#aggregation.MinMaxOverlapAggregator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="aggregation.aggregation.aggregation_interface.DataPointSelector">DataPointSelector</span></code></p>


      <p>Aggregation method which performs binned min-max aggregation over 50% overlapping
windows.</p>
<p><img alt="minmax operator image" src="https://github.com/predict-idlab/plotly-resampler/blob/main/mkdocs/static/minmax_operator.png" /></p>
<p>In the above image, <strong>bin_size</strong>: represents the size of <em>(len(series) / n_out)</em>.
As the windows have 50% overlap and are consecutive, the min &amp; max values are
calculated on a windows with size (2x bin-size).</p>
<p>This is <em>very</em> similar to the MinMaxAggregator, emperical results showed no
observable difference between both approaches.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This method is implemented in Python (leveraging numpy for vecotrization), but
is <strong>significantly slower than the MinMaxAggregator</strong> (which is implemented in
the tsdownsample toolkit in Rust). <br/>
As such, this class does not support any downsample kwargs.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This downsampler supports all dtypes.</p>
</div>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/aggregators.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MinMaxOverlapAggregator</span><span class="p">(</span><span class="n">DataPointSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregation method which performs binned min-max aggregation over 50% overlapping</span>
<span class="sd">    windows.</span>

<span class="sd">    ![minmax operator image](https://github.com/predict-idlab/plotly-resampler/blob/main/mkdocs/static/minmax_operator.png)</span>

<span class="sd">    In the above image, **bin_size**: represents the size of *(len(series) / n_out)*.</span>
<span class="sd">    As the windows have 50% overlap and are consecutive, the min &amp; max values are</span>
<span class="sd">    calculated on a windows with size (2x bin-size).</span>

<span class="sd">    This is *very* similar to the MinMaxAggregator, emperical results showed no</span>
<span class="sd">    observable difference between both approaches.</span>

<span class="sd">    !!! note</span>

<span class="sd">        This method is implemented in Python (leveraging numpy for vecotrization), but</span>
<span class="sd">        is **significantly slower than the MinMaxAggregator** (which is implemented in</span>
<span class="sd">        the tsdownsample toolkit in Rust). &lt;br/&gt;</span>
<span class="sd">        As such, this class does not support any downsample kwargs.</span>

<span class="sd">    !!! note</span>

<span class="sd">        This downsampler supports all dtypes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_arg_downsample</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">n_out</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="c1"># The block size 2x the bin size we also perform the ceil-operation</span>
        <span class="c1"># to ensure that the block_size * n_out / 2 &lt; len(x)</span>
        <span class="n">block_size</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">argmax_offset</span> <span class="o">=</span> <span class="n">block_size</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Calculate the offset range which will be added to the argmin and argmax pos</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">block_size</span> <span class="o">-</span> <span class="n">argmax_offset</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">block_size</span>
        <span class="p">)</span>

        <span class="c1"># Calculate the argmin &amp; argmax on the reshaped view of `y` &amp;</span>
        <span class="c1"># add the corresponding offset</span>
        <span class="n">argmin</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">y</span><span class="p">[:</span> <span class="n">block_size</span> <span class="o">*</span> <span class="n">offset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">block_size</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">offset</span>
        <span class="p">)</span>
        <span class="n">argmax</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">y</span><span class="p">[</span><span class="n">argmax_offset</span> <span class="p">:</span> <span class="n">block_size</span> <span class="o">*</span> <span class="n">offset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">argmax_offset</span><span class="p">]</span>
            <span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">block_size</span><span class="p">)</span>
            <span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">offset</span>
            <span class="o">+</span> <span class="n">argmax_offset</span>
        <span class="p">)</span>

        <span class="c1"># Sort the argmin &amp; argmax (where we append the first and last index item)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">argmin</span><span class="p">,</span> <span class="n">argmax</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.NoGapHandler" class="doc doc-heading">
            <code>NoGapHandler</code>


<a href="#aggregation.NoGapHandler" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="plotly_resampler.aggregation.gap_handler_interface.AbstractGapHandler">AbstractGapHandler</span></code></p>


      <p>No gap handling.</p>

              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/gap_handlers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NoGapHandler</span><span class="p">(</span><span class="n">AbstractGapHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;No gap handling.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_gap_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_agg</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="k">return</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aggregation.PlotlyAggregatorParser" class="doc doc-heading">
            <code>PlotlyAggregatorParser</code>


<a href="#aggregation.PlotlyAggregatorParser" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>plotly_resampler/aggregation/plotly_aggregator_parser.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PlotlyAggregatorParser</span><span class="p">:</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse_hf_data</span><span class="p">(</span>
        <span class="n">hf_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the high-frequency data to a numpy array.&quot;&quot;&quot;</span>
        <span class="c1"># Categorical data (pandas)</span>
        <span class="c1">#   - pd.Series with categorical dtype -&gt; calling .values will returns a</span>
        <span class="c1">#       pd.Categorical</span>
        <span class="c1">#   - pd.CategoricalIndex -&gt; calling .values returns a pd.Categorical</span>
        <span class="c1">#   - pd.Categorical: has no .values attribute -&gt; will not be parsed</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_data</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">hf_data</span><span class="o">.</span><span class="n">values</span>
        <span class="k">return</span> <span class="n">hf_data</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_same_tz</span><span class="p">(</span>
        <span class="n">ts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reference_tz</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pytz</span><span class="o">.</span><span class="n">BaseTzInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust `ts` its timezone to the `reference_tz`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">reference_tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># compare if these two have the same timezone / offset</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">==</span> <span class="n">reference_tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">ts</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span> <span class="o">==</span> <span class="n">reference_tz</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">ts</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># localize -&gt; time remains the same</span>
                <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">reference_tz</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">reference_tz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ts</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_start_end_indices</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">axis_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the start &amp; end indices of the high-frequency data.&quot;&quot;&quot;</span>
        <span class="c1"># Base case: no hf data, or both start &amp; end are None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>

        <span class="c1"># NOTE: as we use bisect right for the end index, we do not need to add a</span>
        <span class="c1">#      small epsilon to the end value</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">end</span>

        <span class="c1"># NOTE: we must verify this before check if the x is a range-index</span>
        <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">start</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">end</span>

        <span class="c1"># We can compute the start &amp; end indices directly when it is a RangeIndex</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
            <span class="n">x_start</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
            <span class="n">x_step</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span>
            <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">start</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span> <span class="o">//</span> <span class="n">x_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span> <span class="o">//</span> <span class="n">x_step</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span>
        <span class="c1"># TODO: this can be performed as-well for a fixed frequency range-index w/ freq</span>

        <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
            <span class="c1"># convert start &amp; end to the same timezone</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
                <span class="n">tz</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tz</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">start</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">==</span> <span class="n">end</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
                    <span class="c1"># This fix is needed for DST (when the timezone is not fixed)</span>
                    <span class="k">assert</span> <span class="n">start</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">start</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span>
                        <span class="kc">None</span>
                    <span class="p">)</span>
                    <span class="k">assert</span> <span class="n">end</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">end</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

                <span class="n">start</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">to_same_tz</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tz</span><span class="p">)</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">to_same_tz</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">tz</span><span class="p">)</span>

        <span class="c1"># Search the index-positions</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">start</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">end</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_gaps</span><span class="p">(</span>
        <span class="n">hf_trace_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">hf_x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">agg_x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">agg_y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle the gaps in the aggregated data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - agg_x: the aggregated x-values</span>
<span class="sd">            - agg_y: the aggregated y-values</span>
<span class="sd">            - indices: the indices of the hf_data data that were aggregated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gap_handler</span><span class="p">:</span> <span class="n">AbstractGapHandler</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;gap_handler&quot;</span><span class="p">]</span>
        <span class="n">downsampler</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;downsampler&quot;</span><span class="p">]</span>

        <span class="c1"># TODO check for trace mode (markers, lines, etc.) and only perform the</span>
        <span class="c1"># gap insertion methodology when the mode is lines.</span>
        <span class="c1"># if trace.get(&quot;connectgaps&quot;) != True and</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">gap_handler</span><span class="p">,</span> <span class="n">NoGapHandler</span><span class="p">)</span>
            <span class="c1"># rangeIndex | datetimeIndex with freq -&gt; equally spaced x; so no gaps</span>
            <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">)</span>
            <span class="ow">or</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">agg_x</span><span class="p">,</span> <span class="n">agg_y</span><span class="p">,</span> <span class="n">indices</span>

        <span class="c1"># Interleave the gaps</span>
        <span class="c1"># View the data as an int64 when we have a DatetimeIndex</span>
        <span class="c1"># We only want to detect gaps, so we only want to compare values.</span>
        <span class="n">agg_x_parsed</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">parse_hf_data</span><span class="p">(</span><span class="n">agg_x</span><span class="p">)</span>
        <span class="n">xdt</span> <span class="o">=</span> <span class="n">agg_x_parsed</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">xdt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">xdt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">):</span>
            <span class="n">agg_x_parsed</span> <span class="o">=</span> <span class="n">agg_x_parsed</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>

        <span class="n">agg_y</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">gap_handler</span><span class="o">.</span><span class="n">insert_fill_value_between_gaps</span><span class="p">(</span>
            <span class="n">agg_x_parsed</span><span class="p">,</span> <span class="n">agg_y</span><span class="p">,</span> <span class="n">indices</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">downsampler</span><span class="p">,</span> <span class="n">DataPointSelector</span><span class="p">):</span>
            <span class="n">agg_x</span> <span class="o">=</span> <span class="n">hf_x</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">downsampler</span><span class="p">,</span> <span class="n">DataAggregator</span><span class="p">):</span>
            <span class="c1"># The indices are in this case a repeat</span>
            <span class="n">agg_x</span> <span class="o">=</span> <span class="n">agg_x</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">agg_x</span><span class="p">,</span> <span class="n">agg_y</span><span class="p">,</span> <span class="n">indices</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span>
        <span class="n">hf_trace_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Aggregate the data in `hf_trace_data` between `start_idx` and `end_idx`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - x: the aggregated x-values</span>
<span class="sd">            - y: the aggregated y-values</span>
<span class="sd">            - indices: the indices of the hf_data data that were aggregated</span>

<span class="sd">            These indices are useful to select the corresponding hf_data from</span>
<span class="sd">            non `x` and `y` data (e.g. `text`, `marker_size`, `marker_color`).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hf_x</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
        <span class="n">hf_y</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

        <span class="c1"># No downsampling needed ; we show the raw data as is, but with gap-detection</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;max_n_samples&quot;</span><span class="p">]:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hf_y</span><span class="p">))</span>  <span class="c1"># no downsampling - all values are selected</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">_handle_gaps</span><span class="p">(</span>
                    <span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">hf_x</span><span class="o">=</span><span class="n">hf_x</span><span class="p">,</span> <span class="n">agg_x</span><span class="o">=</span><span class="n">hf_x</span><span class="p">,</span> <span class="n">agg_y</span><span class="o">=</span><span class="n">hf_y</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">hf_x</span><span class="p">,</span> <span class="n">hf_y</span><span class="p">,</span> <span class="n">indices</span>

        <span class="n">downsampler</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;downsampler&quot;</span><span class="p">]</span>

        <span class="n">hf_x_parsed</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">parse_hf_data</span><span class="p">(</span><span class="n">hf_x</span><span class="p">)</span>
        <span class="n">hf_y_parsed</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">parse_hf_data</span><span class="p">(</span><span class="n">hf_y</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">downsampler</span><span class="p">,</span> <span class="n">DataPointSelector</span><span class="p">):</span>
            <span class="n">s_v</span> <span class="o">=</span> <span class="n">hf_y_parsed</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s_v</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">):</span>  <span class="c1"># pd.Categorical (has no .values)</span>
                <span class="n">s_v</span> <span class="o">=</span> <span class="n">s_v</span><span class="o">.</span><span class="n">codes</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">downsampler</span><span class="o">.</span><span class="n">arg_downsample</span><span class="p">(</span>
                <span class="n">hf_x_parsed</span><span class="p">,</span>
                <span class="n">s_v</span><span class="p">,</span>
                <span class="n">n_out</span><span class="o">=</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;max_n_samples&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">hf_trace_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;downsampler_kwargs&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
                <span class="c1"># we avoid slicing the default pd.RangeIndex (as this is not an</span>
                <span class="c1"># in-memory array) - this proves to be faster than slicing the index.</span>
                <span class="n">agg_x</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">start_idx</span>
                    <span class="o">+</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
                    <span class="o">+</span> <span class="n">indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">*</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">agg_x</span> <span class="o">=</span> <span class="n">hf_x</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">agg_y</span> <span class="o">=</span> <span class="n">hf_y</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">downsampler</span><span class="p">,</span> <span class="n">DataAggregator</span><span class="p">):</span>
            <span class="n">agg_x</span><span class="p">,</span> <span class="n">agg_y</span> <span class="o">=</span> <span class="n">downsampler</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
                <span class="n">hf_x_parsed</span><span class="p">,</span>
                <span class="n">hf_y_parsed</span><span class="p">,</span>
                <span class="n">n_out</span><span class="o">=</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;max_n_samples&quot;</span><span class="p">],</span>
                <span class="o">**</span><span class="n">hf_trace_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;downsampler_kwargs&quot;</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
                <span class="c1"># we avoid slicing the default pd.RangeIndex (as this is not an</span>
                <span class="c1"># in-memory array) - this proves to be faster than slicing the index.</span>
                <span class="n">agg_x</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">start_idx</span>
                    <span class="o">+</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
                    <span class="o">+</span> <span class="n">agg_x</span> <span class="o">*</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span>
                <span class="p">)</span>
            <span class="c1"># The indices are just the range of the aggregated data</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agg_x</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid downsampler instance, must be either a &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;DataAggregator or a DataPointSelector, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">downsampler</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">_handle_gaps</span><span class="p">(</span>
            <span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">hf_x</span><span class="o">=</span><span class="n">hf_x</span><span class="p">,</span> <span class="n">agg_x</span><span class="o">=</span><span class="n">agg_x</span><span class="p">,</span> <span class="n">agg_y</span><span class="o">=</span><span class="n">agg_y</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregation.PlotlyAggregatorParser.aggregate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregate</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#aggregation.PlotlyAggregatorParser.aggregate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Aggregate the data in <code>hf_trace_data</code> between <code>start_idx</code> and <code>end_idx</code>.</p>
<p>Returns:
    - x: the aggregated x-values
    - y: the aggregated y-values
    - indices: the indices of the hf_data data that were aggregated</p>
<div class="highlight"><pre><span></span><code>These indices are useful to select the corresponding hf_data from
non `x` and `y` data (e.g. `text`, `marker_size`, `marker_color`).
</code></pre></div>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/plotly_aggregator_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span>
    <span class="n">hf_trace_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate the data in `hf_trace_data` between `start_idx` and `end_idx`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        - x: the aggregated x-values</span>
<span class="sd">        - y: the aggregated y-values</span>
<span class="sd">        - indices: the indices of the hf_data data that were aggregated</span>

<span class="sd">        These indices are useful to select the corresponding hf_data from</span>
<span class="sd">        non `x` and `y` data (e.g. `text`, `marker_size`, `marker_color`).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hf_x</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
    <span class="n">hf_y</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">][</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>

    <span class="c1"># No downsampling needed ; we show the raw data as is, but with gap-detection</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">end_idx</span> <span class="o">-</span> <span class="n">start_idx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;max_n_samples&quot;</span><span class="p">]:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hf_y</span><span class="p">))</span>  <span class="c1"># no downsampling - all values are selected</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">_handle_gaps</span><span class="p">(</span>
                <span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">hf_x</span><span class="o">=</span><span class="n">hf_x</span><span class="p">,</span> <span class="n">agg_x</span><span class="o">=</span><span class="n">hf_x</span><span class="p">,</span> <span class="n">agg_y</span><span class="o">=</span><span class="n">hf_y</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">hf_x</span><span class="p">,</span> <span class="n">hf_y</span><span class="p">,</span> <span class="n">indices</span>

    <span class="n">downsampler</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;downsampler&quot;</span><span class="p">]</span>

    <span class="n">hf_x_parsed</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">parse_hf_data</span><span class="p">(</span><span class="n">hf_x</span><span class="p">)</span>
    <span class="n">hf_y_parsed</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">parse_hf_data</span><span class="p">(</span><span class="n">hf_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">downsampler</span><span class="p">,</span> <span class="n">DataPointSelector</span><span class="p">):</span>
        <span class="n">s_v</span> <span class="o">=</span> <span class="n">hf_y_parsed</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s_v</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">):</span>  <span class="c1"># pd.Categorical (has no .values)</span>
            <span class="n">s_v</span> <span class="o">=</span> <span class="n">s_v</span><span class="o">.</span><span class="n">codes</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">downsampler</span><span class="o">.</span><span class="n">arg_downsample</span><span class="p">(</span>
            <span class="n">hf_x_parsed</span><span class="p">,</span>
            <span class="n">s_v</span><span class="p">,</span>
            <span class="n">n_out</span><span class="o">=</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;max_n_samples&quot;</span><span class="p">],</span>
            <span class="o">**</span><span class="n">hf_trace_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;downsampler_kwargs&quot;</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
            <span class="c1"># we avoid slicing the default pd.RangeIndex (as this is not an</span>
            <span class="c1"># in-memory array) - this proves to be faster than slicing the index.</span>
            <span class="n">agg_x</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">start_idx</span>
                <span class="o">+</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
                <span class="o">+</span> <span class="n">indices</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">*</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">agg_x</span> <span class="o">=</span> <span class="n">hf_x</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">agg_y</span> <span class="o">=</span> <span class="n">hf_y</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">downsampler</span><span class="p">,</span> <span class="n">DataAggregator</span><span class="p">):</span>
        <span class="n">agg_x</span><span class="p">,</span> <span class="n">agg_y</span> <span class="o">=</span> <span class="n">downsampler</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
            <span class="n">hf_x_parsed</span><span class="p">,</span>
            <span class="n">hf_y_parsed</span><span class="p">,</span>
            <span class="n">n_out</span><span class="o">=</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;max_n_samples&quot;</span><span class="p">],</span>
            <span class="o">**</span><span class="n">hf_trace_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;downsampler_kwargs&quot;</span><span class="p">,</span> <span class="p">{}),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
            <span class="c1"># we avoid slicing the default pd.RangeIndex (as this is not an</span>
            <span class="c1"># in-memory array) - this proves to be faster than slicing the index.</span>
            <span class="n">agg_x</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">start_idx</span>
                <span class="o">+</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
                <span class="o">+</span> <span class="n">agg_x</span> <span class="o">*</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span>
            <span class="p">)</span>
        <span class="c1"># The indices are just the range of the aggregated data</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">agg_x</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid downsampler instance, must be either a &quot;</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;DataAggregator or a DataPointSelector, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">downsampler</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">_handle_gaps</span><span class="p">(</span>
        <span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">hf_x</span><span class="o">=</span><span class="n">hf_x</span><span class="p">,</span> <span class="n">agg_x</span><span class="o">=</span><span class="n">agg_x</span><span class="p">,</span> <span class="n">agg_y</span><span class="o">=</span><span class="n">agg_y</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aggregation.PlotlyAggregatorParser.get_start_end_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_start_end_indices</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">axis_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#aggregation.PlotlyAggregatorParser.get_start_end_indices" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the start &amp; end indices of the high-frequency data.</p>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/plotly_aggregator_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_start_end_indices</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">,</span> <span class="n">axis_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the start &amp; end indices of the high-frequency data.&quot;&quot;&quot;</span>
    <span class="c1"># Base case: no hf data, or both start &amp; end are None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>

    <span class="c1"># NOTE: as we use bisect right for the end index, we do not need to add a</span>
    <span class="c1">#      small epsilon to the end value</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">end</span>

    <span class="c1"># NOTE: we must verify this before check if the x is a range-index</span>
    <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">start</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">end</span>

    <span class="c1"># We can compute the start &amp; end indices directly when it is a RangeIndex</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
        <span class="n">x_start</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">start</span>
        <span class="n">x_step</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">step</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">start</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span> <span class="o">//</span> <span class="n">x_step</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">x_start</span><span class="p">)</span> <span class="o">//</span> <span class="n">x_step</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span>
    <span class="c1"># TODO: this can be performed as-well for a fixed frequency range-index w/ freq</span>

    <span class="k">if</span> <span class="n">axis_type</span> <span class="o">==</span> <span class="s2">&quot;date&quot;</span><span class="p">:</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="c1"># convert start &amp; end to the same timezone</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
            <span class="n">tz</span> <span class="o">=</span> <span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tz</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">start</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">==</span> <span class="n">end</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
                <span class="c1"># This fix is needed for DST (when the timezone is not fixed)</span>
                <span class="k">assert</span> <span class="n">start</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">start</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span>
                    <span class="kc">None</span>
                <span class="p">)</span>
                <span class="k">assert</span> <span class="n">end</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="n">end</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">start</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">to_same_tz</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">tz</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">PlotlyAggregatorParser</span><span class="o">.</span><span class="n">to_same_tz</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">tz</span><span class="p">)</span>

    <span class="c1"># Search the index-positions</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">start</span><span class="p">)</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">hf_trace_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">end</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aggregation.PlotlyAggregatorParser.parse_hf_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_hf_data</span><span class="p">(</span><span class="n">hf_data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#aggregation.PlotlyAggregatorParser.parse_hf_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Parse the high-frequency data to a numpy array.</p>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/plotly_aggregator_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_hf_data</span><span class="p">(</span>
    <span class="n">hf_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse the high-frequency data to a numpy array.&quot;&quot;&quot;</span>
    <span class="c1"># Categorical data (pandas)</span>
    <span class="c1">#   - pd.Series with categorical dtype -&gt; calling .values will returns a</span>
    <span class="c1">#       pd.Categorical</span>
    <span class="c1">#   - pd.CategoricalIndex -&gt; calling .values returns a pd.Categorical</span>
    <span class="c1">#   - pd.Categorical: has no .values attribute -&gt; will not be parsed</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hf_data</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">hf_data</span><span class="o">.</span><span class="n">values</span>
    <span class="k">return</span> <span class="n">hf_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aggregation.PlotlyAggregatorParser.to_same_tz" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_same_tz</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">reference_tz</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#aggregation.PlotlyAggregatorParser.to_same_tz" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Adjust <code>ts</code> its timezone to the <code>reference_tz</code>.</p>

            <details class="quote">
              <summary>Source code in <code>plotly_resampler/aggregation/plotly_aggregator_parser.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">to_same_tz</span><span class="p">(</span>
    <span class="n">ts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">reference_tz</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pytz</span><span class="o">.</span><span class="n">BaseTzInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust `ts` its timezone to the `reference_tz`.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">reference_tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># compare if these two have the same timezone / offset</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">==</span> <span class="n">reference_tz</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">ts</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span> <span class="o">==</span> <span class="n">reference_tz</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">ts</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># localize -&gt; time remains the same</span>
            <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="n">reference_tz</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">reference_tz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.path", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>